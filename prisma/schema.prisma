// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum EditorTheme {
  LIGHT
  DARK
}

model User {
  id Int @id

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  createdPastes Paste[]
  likedPastes UserPasteLike[]

  editorTheme EditorTheme @default(DARK)

  @@map("users")
}

enum PasteVisibility {
  PUBLIC
  HIDDEN
  PRIVATE
}

model Paste {
  id String @id

  title String

  views BigInt @default(0)

  userLikes UserPasteLike[]

  pasteForks Paste[] @relation("forked_pastes")

  revisions PasteRev[]

  softDeleted Boolean @default(false)

  visibility PasteVisibility @default(PRIVATE)

  expirationDate DateTime?

  creatorId Int?
  creator User? @relation(fields: [creatorId], references: [id])

  creatorAddr String? @db.Inet

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  forkedPasteId String?
  forkedPaste Paste? @relation("forked_pastes", fields: [forkedPasteId], references: [id])

  @@map("pastes")
}

model PasteRev {
  id Int @default(autoincrement())

  pasteId String
  paste Paste @relation(fields: [pasteId], references: [id])

  content String

  createdAt DateTime @default(now())
  
  @@id([pasteId, id])

  @@map("paste_revs")
}

model UserPasteLike {
  userId Int
  user User @relation(fields: [userId], references: [id])

  pasteId String
  paste Paste @relation(fields: [pasteId], references: [id])

  @@id([userId, pasteId])

  @@map("user_paste_likes")
}
